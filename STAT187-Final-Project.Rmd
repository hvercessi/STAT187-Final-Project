---
title: 'Stat/CS 187: Final Project'
author: "Huaye Yang, Halina Vercessi, and Matthew Mccarthy"
date: "Spring 2022"
output:
  word_document:
    toc: yes
  html_document:
    toc: yes
    df_print: paged
  pdf_document:
    toc: yes
---
  

```{r setup, message = FALSE, warning=F}
knitr::opts_chunk$set(echo = TRUE,
                      fig.width=12, 
                      fig.height=10)

# Load the packages
pacman::p_load(gapminder, tidyverse, skimr, socviz, grid, stringr,
               usmap, maps, statebins, viridis, leaflet, cowplot, gridExtra, rpart, rpart.plot, caret, caTools)

```  

***

# 1. Introduction

Before this survey, the most detailed data and reports on this subject were 
gathered and made in 2004 by the National Sleep Foundation. The data from the 
National Sleep Foundation provided the numbers on how many couples slept separately 
but did not gather data that could offer insight as to the reasons couples sleep apart 
and why couples sleep in separate beds. This data is interesting because it is the 
kind of data that could be useful to psychologists and social workers. This data 
can be used to examine stereotypes we have about why couples sleep separately 
and which age ranges of couples sleep separately along with being useful for 
examining why couples sleep separately.The data comes from a survey created in 
2014 by Mona Chalabi as research for an article for Five Thirty Eight (from ABC News). 
The population from which this sample was drawn includes 1,057 American adults 
who were married, in a domestic partnership, in civil union or cohabiting with a 
significant other. The sample was selected with the help of SurveyMonkey, which 
gathered all 1,057 responses.  

The participants only need to check boxes that they think best describes their 
situation. Bias can easily occur in this survey because:

1. It may be hard for participants to find a certain categorical box within 
each question to best describe their situation. In this circumstances, samples
that are considered as outlier will fall into one of the categorical values. 
Also, we are only able to do a rough analysis based on designed categorical 
values. It can't provide detailed information or quantitative analysis for 
accurate numerical values. 

2. Participants may overly/underly describe their situation due to the form of 
survey. What we have in dataset is subjective, not objective.

3. We are not sure whether this survey is voluntary. If this is forced or hard
for participants to refuse, the data can be messed because participants may 
randomly select the boxes instead of actually looking into the questions and 
participate. Also, we can't guarantee how reliable the data is. From the 
recorded time (EndDate - StartDate),participants only spent around 3 minutes
for answering 29 questions (Some of them only use less than 1 minute). There 
might be part of the data that are not meaningful. If this survey is voluntary 
(or maybe taken at a counselling institution,etc), participants who are willing 
to answer these questions may already have issues or at least went through the 
situation that were asked in the survey. This means we are not getting randomly 
distributed samples.

The cleaning that was done on the data was to rename the columns because the 
original column names were built from the survey questions (separated by periods) 
and they were very long and tedious to work with. Additionally, during the building 
of the following graphs, responses that were left blank were omitted to focus on 
relevant responses. We also removed the first row as it served as almost a second title 
row but was being counted in the rows of data. We considered labeling the blank / 
no answer spaces as N/A but N/A means something in this data as it is a valid 
response to specific check boxes. 





```{r clean_data, message=F, warning=F}

# Read in data
sleeping_alone_data1 <- read.csv("R_sleeping_alone.csv", stringsAsFactors = T)

# Take a look at the relationship status column, 7 categories
#summary(sleeping_alone_data1)

# Rename columns to simpler names based on survey questions
sleeping_alone_data <- sleeping_alone_data1 %>%
  
  rename( Relationship_Status = Which.of.the.following.best.describes.your.current.relationship.status., 
         Relationship_Length = How.long.have.you.been.in.your.current.relationship..If.you.are.not.currently.in.a.relationship..please.answer.according.to.your.last.relationship.,
         How_Often_Sep_Beds = When.both.you.and.your.partner.are.at.home..how.often.do.you.sleep.in.separate.beds., 
         Diff_Bed_Where_You_Sleep = When.you.re.not.sleeping.in.the.same.bed.as.your.partner..where.do.you.typically.sleep., 
         Diff_Bed_Where_Partner_Sleep = When.you.re.not.sleeping.in.the.same.bed..where.does.your.partner.typically.sleep., 
         Sep_Beds_Reasons = What.are.the.reasons.that.you.sleep.in.separate.beds..Please.select.all.that.apply., 
         When_First_Time_Sep_Beds = When.was.the.first.time.you.slept.in.separate.beds., 
         Statement_Help_Stay_Together =  To.what.extent.do.you.agree.with.the.following.statement...sleeping.in.separate.beds.helps.us.to.stay.together.., 
         Statement_Better_Sleep =  To.what.extent.do.you.agree.with.the.following.statement...we.sleep.better.when.we.sleep.in.separate.beds..,
         Statement_Improved_Sex_Life = To.what.extent.do.you.agree.with.the.following.statement.ë_.our.sex.life.has.improved.as.a.result.of.sleeping.in.separate.beds..ë_, 
         Current_Occupation =  Which.of.the.following.best.describes.your.current.occupation.,
         Household_Income = Household.Income,  
         Location_Census_Region = Location..Census.Region.)
  

sleeping_alone_data <- sleeping_alone_data %>% slice(-c(1))


```

***

# 2. Data Visualizations


## 2.1 Length of Relationship and Age (Graph 1):  


### 2.1.1 Graph 1 
```{r 2a_graph1, message=F, warning=F}

# Prepare data
sleeping_alone_data2 <- sleeping_alone_data %>%
  
  filter(Relationship_Length != "", How_Often_Sep_Beds != "") %>%
  
  group_by(Relationship_Length, How_Often_Sep_Beds) %>%
  
  summarise(count_freq = n()) %>%
  
  mutate(Proportion = round(count_freq/sum(count_freq), digits = 5)) %>%
  
  select(Relationship_Length, How_Often_Sep_Beds, Proportion) %>% 
  
  slice(-c(1)) %>%
  
  ungroup()

# Bar graph 1: relationship length and frequency sleeping separately 
rel_length_bar <- ggplot(data = sleeping_alone_data2,
                            mapping = aes(x = Relationship_Length,
                                          y = Proportion, 
                                          fill = How_Often_Sep_Beds)) +
  
                     geom_col(position = "dodge") + 
  
                     labs(x = "Relationship Length",
                          fill = "How Often Couples Sleep Separately", 
                          title = "Frequency Sleeping Separately and Relationship Length (proportions)")+
  
                    scale_y_continuous(labels = scales::percent) +
                    facet_wrap(~How_Often_Sep_Beds) +
                    theme(legend.position = "NA", 
                          title = element_text(size = 9)) +
                    coord_flip()

rel_length_bar

```

```{r 2a_graph1.1}

# Prepare data
sleeping_alone_data3 <- sleeping_alone_data %>%
  
  filter(Age != "", How_Often_Sep_Beds != "") %>%
  
  group_by(Age, How_Often_Sep_Beds) %>%
  
  summarise(count_freq = n()) %>%
  
  mutate(Proportion = round(count_freq/sum(count_freq), digits = 5)) %>%
  
  select(Age, How_Often_Sep_Beds, Proportion) %>% 
  
  slice(-c(1)) %>%
  
  ungroup()

# Bar graph 2: Age and frequency sleeping separately
prop_age_bar <- ggplot(data = sleeping_alone_data3,
                            mapping = aes(x = Age,
                                          y = Proportion, 
                                          fill = How_Often_Sep_Beds)) +
  
                     geom_col(position = "dodge") + 
  
                     labs(x = "Age",
                          fill = "How Often Couples Sleep Separately", 
                          title = "Frequency Sleeping Separately and Age (proportions)")+
  
                    scale_y_continuous(labels = scales::percent)+ 
                    scale_x_discrete(name = "Age Range", labels = c("60-Up", "18-29", "30-44", "45-60")) +
                    facet_wrap(~How_Often_Sep_Beds) +
                    theme(legend.position = "NA", 
                          title = element_text(size = 9)) +
                    coord_flip()

prop_age_bar

```


### 2.1.2 Summarizing Paragraph:

From these two graphs, it is clear that the majority of couples who took the 
survey do not sleep separately. From the first graph, around 18% of couples who
have been in a relationship for 16-20 years and more than 20 years do sleep in 
separate beds. These percentages are on the higher end for proportions of couples 
that have slept or do sleep separately. This aspect of the data fits our society's 
stereotyping that couples who have been together longer are more likely to sleep 
separately. Another notable percentage is that almost 20% of couples who have been 
together for less than a year reported sleeping separately once a month or less. 

These graphs communicate and fit what the public might expect to see from a survey like 
this, however, it does not give any indication as to the reasons couples who have 
been together longer might be sleeping separately. The following sections and figures 
will aim to further examine this aspect of the population sample. More specifically,
could occupation and income (which are often tied to how busy or occupied a person 
might be in their daily activities) be related to couple sleeping separately? 
Additionally, what are the reasons for certain categories of couples (older, younger, etc) 
sleeping separately and have they noticed changes in their relationship from sleeping separately? 


***


### 2.2 Occupation and Income

# Relate occupation,gender and bed status with how often they sleep separately.

### 2.2.1 Graph 2
```{r 2b_graph2}
# change the default theme below:
theme_set(theme_bw())

# set levels in order to give a better visisualization in color
rank<-as.factor(sleeping_alone_data$How_Often_Sep_Beds)
sleeping_alone_data4 <- sleeping_alone_data %>%
  mutate(How_Often_Sep_Beds = factor(rank, ordered = TRUE, 
                                     levels = c("Never",
                                               "Once a year or less",
                                               "Once a month or less",
                                               "A few times per month",
                                               "A few times per week",
                                               "Every night")))
# Relate occupation to bed status (and how often they sleep)
# Overall plot
sleeping_alone_data4 %>%
  group_by(Current_Occupation)%>%
  ggplot(data = sleeping_alone_data,
       mapping = aes(x = Current_Occupation,
                     fill = How_Often_Sep_Beds)) +
  geom_bar(position="dodge")+
  labs(fill = "Frequncy Sleeping Separately") +
  theme(axis.text.x = element_text(angle = 90,
                                   hjust = 1,
                                   vjust = 0.25,
                                   size = 7),
        legend.position = "top",
        legend.text = element_text(size = 7),
        legend.key.size = unit(0.25,'cm'),
        legend.title = element_text(size= 8),
        axis.title.x = element_blank(),
        axis.title.y = element_blank())

#### for each bed status below:
# Never
sleeping_alone_data4 %>%
  select(Current_Occupation,How_Often_Sep_Beds) %>%
  filter(How_Often_Sep_Beds == "Never") %>%
  ggplot(aes(y = Current_Occupation,
             color = How_Often_Sep_Beds))+
  geom_bar(fill = "purple4")+
  labs(fill = "Frequncy Sleeping Separately") +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank())
  
# Once a year or less 
sleeping_alone_data4 %>%
  select(Current_Occupation,How_Often_Sep_Beds) %>%
  filter(How_Often_Sep_Beds == "Once a year or less") %>%
  ggplot(aes(y = Current_Occupation,
             color = How_Often_Sep_Beds))+
  geom_bar(fill = "darkslateblue")+
  labs(fill = "Frequncy Sleeping Separately") +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank())
# Once a month or less
sleeping_alone_data4 %>%
  select(Current_Occupation,How_Often_Sep_Beds) %>%
  filter(How_Often_Sep_Beds == "Once a month or less") %>%
  ggplot(aes(y = Current_Occupation,
             color = How_Often_Sep_Beds))+
  geom_bar(fill = "cadetblue4")+
  labs(fill = "Frequncy Sleeping Separately") +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank())
# A few times per month 
sleeping_alone_data4 %>%
  select(Current_Occupation,How_Often_Sep_Beds) %>%
  filter(How_Often_Sep_Beds == "A few times per month") %>%
  ggplot(aes(y = Current_Occupation,
             color = How_Often_Sep_Beds))+
  geom_bar(fill = "lightseagreen")+
  labs(fill = "Frequncy Sleeping Separately") +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank())
# A few times per week
sleeping_alone_data4 %>%
  select(Current_Occupation,How_Often_Sep_Beds) %>%
  filter(How_Often_Sep_Beds == "A few times per week") %>%
  ggplot(aes(y = Current_Occupation,
             color = How_Often_Sep_Beds))+
  geom_bar(fill = "palegreen3")+
  labs(fill = "Frequncy Sleeping Separately") +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank())
# Every night
sleeping_alone_data4 %>%
  select(Current_Occupation,How_Often_Sep_Beds) %>%
  filter(How_Often_Sep_Beds == "Every night") %>%
  ggplot(aes(y = Current_Occupation,
              color= How_Often_Sep_Beds))+
  geom_bar(fill = "khaki1")+
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank())

## for people who have further response instead of checking boxes
## (choose to plot those who answered "retired" or "Retired)
sleeping_alone_data4 %>%
  filter(X.12 == "retired" | X.12 == "Retired")%>%
  mutate(X.12 ="retired") %>%
  
  ggplot(aes(x = X.12, fill= How_Often_Sep_Beds)) +
  
  geom_bar(color="white",position = "dodge")+
  labs(fill = "Frequncy Sleeping Separately") +
  theme(axis.text.x = element_text(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank()) 
```

### 2.2.2 Summarizing Paragraph

The first thing we need to notice from the first overall plot is the proportion
of each occupation that our participants came from. Since they all have the 
same scale on y-axis, it is not hard to find the top 5 occupations(ranked in 
number of participants).Also, this gave us a general sense of the make-up for
our dataset and how representative it is.We would like to look at the top 5 
occupations in detail and give a more specific interpretation. The top 5
occupations, as we see in second plot, are [Education, Training, and Library 
Occupations](138 participants),[Other (please specify)](289 participants),
[Office and Administrative Support Occupations](82 participants),
[Management Occupations](67 participants),[Sales and Related Occupations]
(53 participants). 


People who are in Education, Training, and Library Occupations seems to have the 
most response of "Never" sleeping separately(around 50% ~ 60%). Regardless of the 
occupation, the number of people who sleep separately is bigger than other 
frequencies. This might refer to a bias where participants may over/under
estimate their circumstances while doing self-evaluation.


For people who checked the box of "Other(please specify)", we select retired 
samples to draw a bar graph. Distribution of people who retired have heavy tails
on both side(Never & Every night), but the number of people who never sleeping 
separately is almost twice as large as those who sleeping separately every night.


### 2.2.3 Graph 3
```{r 2b_graph3}

# take a look at the categories of Household_Income
summary(sleeping_alone_data4$Household_Income)
# change Household_Income into an ordered factor(in the dataset where 
# How_Often_Sep_Beds alreay function as an ordered factor)
rank<-as.factor(sleeping_alone_data4$Household_Income)
sleeping_alone_data4_2 <- sleeping_alone_data4 %>%
  mutate(Household_Income = factor(rank, ordered = TRUE, 
                                     levels = c("NA",
                                                "$0 - $24,999",
                                                "$25,000 - $49,999",
                                                "$50,000 - $99,999",
                                                "$100,000 - $149,999",
                                                "$150,000+",
                                                "Response")))
# create a proportion variable for plotting
sleeping_alone_data4_2 <- sleeping_alone_data4_2 %>%
  
  group_by(Household_Income, How_Often_Sep_Beds) %>% 
 
  summarise(freq = n()) %>% 
 
  mutate(Prop = round(freq/sum(freq), digits = 5)) %>% 
 
  select(Household_Income, How_Often_Sep_Beds, Prop) %>% 
 
  ungroup()
# make a bar plot and separate by Household_Income
sleeping_alone_data4_2 %>% 
  filter(Household_Income != "NA") %>%
  
  ggplot(aes(y = Prop,
             x = How_Often_Sep_Beds,
             fill = Household_Income)) +
  geom_col(show.legend = F)+
  
  scale_y_continuous(labels = scales::percent)+
  
  theme(axis.text.x = element_text(angle = 90),
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  coord_flip()+
  facet_wrap(~Household_Income)
```
### 2.2.4 Summarizing Paragraph:
When we relate household income to how often participants sleep separately with
their partner, we can see that there is not a significant difference between 
groups with different levels of income. The proportion of answers for both tails
takes more than half of the total number of answers. The number of answer tend 
to decrease as the frequency of sleeping separately increases, but not for both 
tails.



## 2.3 Reasons for Sleeping Separately (Graph 4) 

**Relate how often couples sleep in different beds with the reason they sleep separately.**

**How correlated are the reasons they sleep in separate beds with the frequency they sleep together?**
**Reasons include snoring, frequent bathroom trips, sickness, intimacy issues, etc.**

### 2.3.1 Graph 4
```{r 2c_graph4}
# GRAPH 4

#Horizontal Bar Chart for Reason 1
sleeping_alone_data5 <- sleeping_alone_data %>% 
  
  group_by(Sep_Beds_Reasons, How_Often_Sep_Beds) %>% 
  
  summarise(freq = n()) %>% 
  
  mutate(Prop = round(freq/sum(freq), digits = 5)) %>% 
  
  select(Sep_Beds_Reasons, How_Often_Sep_Beds, Prop) %>% 
  
  slice(-c(1)) %>% 
  
  ungroup()
BarOftenVsReason1 <- ggplot(data = sleeping_alone_data5,
                               mapping = aes(y = Prop,
                                             x = How_Often_Sep_Beds,
                                             fill = How_Often_Sep_Beds)) +
  
  geom_bar(stat = "identity",
           show.legend = F) + 
  coord_flip() + 
  labs(title = "One of Us Snores",
       x = "",
       y = "") +
  scale_y_continuous(labels = scales::percent) +
  
  theme(plot.title = element_text(size = 15, hjust = 0.5))
#Horizontal Bar Chart for Reason 2
sleeping_alone_data6 <- sleeping_alone_data %>% 
  
  group_by(X.2, How_Often_Sep_Beds) %>% 
  
  summarise(freq = n()) %>% 
  
  mutate(Prop = round(freq/sum(freq), digits = 5)) %>% 
  
  select(X.2, How_Often_Sep_Beds, Prop) %>% 
  
  slice(-c(1)) %>% 
  
  ungroup()
BarOftenVsReason2 <- ggplot(data = sleeping_alone_data6,
                               mapping = aes(y = Prop,
                                             x = How_Often_Sep_Beds,
                                             fill = How_Often_Sep_Beds)) +
  
  geom_bar(stat = "identity",
           show.legend = F) + 
  coord_flip() + 
  labs(title = "Frequent Bathroom Trips",
       x = "",
       y = "") +
  
  scale_y_continuous(labels = scales::percent) +
  
  theme(plot.title = element_text(size = 15, hjust = 0.5))
#Horizontal Bar Chart for Reason 3
sleeping_alone_data7 <- sleeping_alone_data %>% 
  
  group_by(X.4, How_Often_Sep_Beds) %>% 
  
  summarise(freq = n()) %>% 
  
  mutate(Prop = round(freq/sum(freq), digits = 5)) %>% 
  
  select(X.4, How_Often_Sep_Beds, Prop) %>% 
  
  slice(-c(1)) %>% 
  
  ungroup()
BarOftenVsReason3 <- ggplot(data = sleeping_alone_data7,
                               mapping = aes(y = Prop,
                                             x = How_Often_Sep_Beds,
                                             fill = How_Often_Sep_Beds)) +
  
  geom_bar(stat = "identity",
           show.legend = F) + 
  coord_flip() + 
  labs(title = "No Longer Physically Intimate",
       x = "",
       y = "") +
  
  scale_y_continuous(labels = scales::percent) +
  
  theme(plot.title = element_text(size = 15, hjust = 0.5))
#Horizontal Bar Chart for Reason 4
sleeping_alone_data8 <- sleeping_alone_data %>% 
  
  group_by(X.5, How_Often_Sep_Beds) %>% 
  
  summarise(freq = n()) %>% 
  
  mutate(Prop = round(freq/sum(freq), digits = 5)) %>% 
  
  select(X.5, How_Often_Sep_Beds, Prop) %>% 
  
  slice(-c(1)) %>% 
  
  ungroup()
BarOftenVsReason4 <- ggplot(data = sleeping_alone_data8,
                               mapping = aes(y = Prop,
                                             x = How_Often_Sep_Beds,
                                             fill = How_Often_Sep_Beds)) +
  
  geom_bar(stat = "identity",
           show.legend = F) + 
  coord_flip() + 
  labs(title = "Different Temperature Preferences",
       x = "",
       y = "") +
  
  scale_y_continuous(labels = scales::percent) +
  
  theme(plot.title = element_text(size = 15, hjust = 0.5))
#Horizontal Bar Chart for Reason 5
sleeping_alone_data9 <- sleeping_alone_data %>% 
  
  group_by(X.6, How_Often_Sep_Beds) %>% 
  
  summarise(freq = n()) %>% 
  
  mutate(Prop = round(freq/sum(freq), digits = 5)) %>% 
  
  select(X.6, How_Often_Sep_Beds, Prop) %>% 
  
  slice(-c(1)) %>% 
  
  ungroup()
BarOftenVsReason5 <- ggplot(data = sleeping_alone_data9,
                               mapping = aes(y = Prop,
                                             x = How_Often_Sep_Beds,
                                             fill = How_Often_Sep_Beds)) +
  
  geom_bar(stat = "identity",
           show.legend = F) + 
  coord_flip() + 
  labs(title = "Arguments / Fights",
       x = "",
       y = "") +
  
  scale_y_continuous(labels = scales::percent) +
  
  theme(plot.title = element_text(size = 15, hjust = 0.5))
#Horizontal Bar Chart for Reason 6
sleeping_alone_data10 <- sleeping_alone_data %>% 
  
  group_by(X.8, How_Often_Sep_Beds) %>% 
  
  summarise(freq = n()) %>% 
  
  mutate(Prop = round(freq/sum(freq), digits = 5)) %>% 
  
  select(X.8, How_Often_Sep_Beds, Prop) %>% 
  
  slice(-c(1)) %>% 
  
  ungroup()
BarOftenVsReason6 <- ggplot(data = sleeping_alone_data10,
                               mapping = aes(y = Prop,
                                             x = How_Often_Sep_Beds,
                                             fill = How_Often_Sep_Beds)) +
  
  geom_bar(stat = "identity",
           show.legend = F) + 
  coord_flip() + 
  labs(title = "Not Wanting to Share Covers",
       x = "",
       y = "") +
  
  scale_y_continuous(labels = scales::percent) +
  
  theme(plot.title = element_text(size = 8, hjust = 0.5))
grid.arrange(BarOftenVsReason1, BarOftenVsReason2, BarOftenVsReason3, BarOftenVsReason4, BarOftenVsReason5, BarOftenVsReason6,nrow = 2,
             top=textGrob("Comparing How Often Couples Sleep In Different Beds With Reasons They Sleep Separately", 
             gp=gpar (fontsize=10, fontface = "bold")))

```


```{r 2c_graph4.1}
# GRAPH 5

help_stay_together <- sleeping_alone_data %>% filter(Statement_Help_Stay_Together != "") %>%
                      ggplot(mapping = aes(x = Statement_Help_Stay_Together,
                                           fill = How_Often_Sep_Beds)) +
                     geom_bar(position = "dodge") + 
                     labs(x = "Helped Us Stay Together",
                          fill = "How Often Couples Sleep Separately",
                          title = "Frequency Sleeping Separately and Improvements") +
                     theme(legend.position = "NA", 
                           title = element_text(size = 9)) +
                     coord_flip()

better_sleep <- sleeping_alone_data %>% filter(Statement_Better_Sleep != "") %>%
                      ggplot(mapping = aes(x = Statement_Better_Sleep,
                                           fill = How_Often_Sep_Beds)) +
                     geom_bar(position = "dodge") + 
                     labs(x = "Helped Improve Sleep",
                          fill = "How Often Couples Sleep Separately") +
                     theme(legend.position = "NA" ) +
                     coord_flip()

improved_sex_life <- sleeping_alone_data %>% filter(Statement_Improved_Sex_Life != "") %>%
                      ggplot(mapping = aes(x = Statement_Improved_Sex_Life,
                                           fill = How_Often_Sep_Beds)) +
                     geom_bar(position = "dodge") + 
                     labs(x = "Helped Improve Sex Life",
                          fill = "How Often Couples Sleep Separately") +
                     theme(legend.position = "bottom",
                           legend.key.size = unit(0.25, 'cm'), 
                           legend.title = element_blank(), 
                           legend.text = element_text(size=9)) +
                     coord_flip()



plot_grid(help_stay_together, better_sleep, improved_sex_life, ncol = 2, nrow = 2, label_size = 9) 


```
### 2.3.2 Summarizing Paragraph:

These graphs compare how often couples sleep in different beds with some reasons 
why they sleep separately. The reason that the percentages add up to over 100% is 
because this part of the survey involved selecting all that applied. One specific 
pattern that I notice is that sleeping separately "a few times per month" is 
clearly the least common response among all reasons. Most of the reasons have the 
highest percentage of sleeping separately "every night", except for arguments and 
fights which has by far the lowest percentage. This makes sense to think about
because couples do not usually have arguments or fights every night. They generally 
happen on occasion, which is why the arguments/fights graph has the highest percentage 
of sleeping separately "once a year or less" and "once a month or less". Besides 
arguments and fights, the graphs have similar distributions.

In terms of improvements, majority of couples who sleep in separate beds every night 
who did not answer neutrally, reported strongly agreeing with the statement "it helped save our relationship". 
Most notably, the vast majority of couples sleeping separately every night stated that sleeping 
separately improved their sleep. When it comes to improvements in sex life, the results are 
less descriptive and there seems to be less unanimous improvements in this category. 
Overall, the reasons that couples chose to sleep apart every night were practical sleep reasons
relating to sleeping habits such as temperature differences, middle-of-the-night disturbances, 
snoring, and cover-sharing. 


***


## Machine Learning Methods:  
Apply one or more of the modeling or other machine learning techniques that we’ve learned in class. 
Describe your reasons for using the method – why it is appropriate. Describe the conclusions of each particular analysis. 
Include more visualizations, as needed.

Can we predict if a couple sleeps separately at all based on Relationship Status, Relationship Length, Age, and Current Occupation?

The feature we want to classify is How_Often_Sep_Beds (how often couples sleep separately). We will be using a decision tree to model the data because each of the features which we are analyzing are categorical variables and the target variable is also categorical. Something to note is that the vast majority of people did answer that they never sleep separately and so we will be adjusting the frequency of sleeping separately responses to be a binary response (No = never sleep separately, Yes = do sleep separately to some degree). This will simplify the response more and allow for a model to be more useful.  

#### Create Training and Test Data

``` {r splitdata, warning = FALSE}
RNGversion('4.0.0')
set.seed(123)

# Remove empty responses
sleeping_sep_ML <- sleeping_alone_data %>% 
  select(How_Often_Sep_Beds, Relationship_Length, Age) %>% 
  
  filter(!How_Often_Sep_Beds=="", !Age=="", !Relationship_Length=="") %>% 
  
  # Make the response binary
  mutate(Binary_Sleeping_Sep = factor(How_Often_Sep_Beds, 
                            levels = c("Never", "A few times per month", "A few times per week", "Once a year or less", "Once a month or less", "Every night"),
                            labels = c("No", "Yes", "Yes", "Yes", "Yes", "Yes"))) %>%
  
  dplyr::select(-How_Often_Sep_Beds)  
  

# Create training and testing data sets
holdout_sleeping <- holdout_split(df = sleeping_sep_ML, pred = "Binary_Sleeping_Sep", train_percent = 0.70)

# Check the proportions
table(holdout_sleeping$train_y) %>% 
  prop.table() %>% 
  round(digits = 5)

table(holdout_sleeping$test_y) %>% 
  prop.table() %>% 
  round(digits = 5)

```

#### Training a Model on the Data

``` {r traintree, warning = FALSE}

# Create model and train it on the training data
train_df <- data.frame(holdout_sleeping$train_x,
                       Binary_Sleeping_Sep = holdout_sleeping$train_y)
      
sleeping_tree <- rpart(formula = Binary_Sleeping_Sep ~ .,
                     data = train_df,
                     method = "class",
                     parms = list(split = "information"),
                     minsplit = 0, 
                     minbucket = 0,
                     cp = -1)  

rpart.plot(x = sleeping_tree,
           type = 5,
           extra = 104)

```

#### Pruning the Tree

``` {r prunetree}

# Finding the lowest xerror:
sleeping_tree$cptable %>% 
  data.frame() %>% 
  filter(xerror == min(xerror))

# Locating where to prune the tree - simplest tree with xerror < min(xerror) + xstd:
sleeping_tree$cptable %>% 
  data.frame() %>% 
  filter(xerror < min(xerror) + 0.04055872)
  
# CP returned is 0.01, go a little below 
sleeping_pruned <- prune(sleeping_tree,
                       cp = 0.006)

rpart.plot(x = sleeping_pruned,
           type = 5,
           extra = 104)
```
  
#### Evaluating Model Performance

``` {r treeperf}

sleeping_pred <- predict(object = sleeping_pruned,
                       newdata = holdout_sleeping$test_x,
                       type = "class")


# Confusion Matrix of predicted vs actual classes
cm_sleeping <- 
  confusionMatrix(data = sleeping_pred, 
                  reference = holdout_sleeping$test_y,
                  positive = "No",
                  dnn = c('predicted', 'actual'))

cm_sleeping

```
Summary: 

The accuracy of this pruned decision tree model on this data is about 60% which is somewhat low. 
Considering the two features that were analyzed in relation to frequency sleeping separately 
and that there were only two features that are fairly general (Relationship length and Age), 
the model being able to predict if a couple never sleeps separately with a 60% accuracy is not bad. 
The single CP value that was given was close to 0.01, but after trying 0.008, 0.009, and 0.01, 
all of these CP values pruned the tree a little too much and so we went with a CP value of 0.006 which 
resulted in the pruned tree above. One thing that the decision tree illustrated that was an unexpected insight 
was that people in age groups over 60, 18-29, and 30-44 are shown to be more likely to not sleep separately if 
they have been in a relationship for 16-20 than if they have been in a relationship 11-15 years. 


# 3 Conclusions:  

This data does illustrate a tendancy toward stereotypical patterns in our society 
regarding age / relationship length and sleeping situation. That being that couples 
who are older (or have one partner who is older) are more likely to sleep in 
separate beds. Additionally couples who have been together for at least a decade are
much more likely to sleep in separate beds. That being said, the purpose of this data was
to help shed light on the factors involved in sleeping separately and allow us to examine 
the reasons why couples choose ot sleep separately. It seems that the reasons are highly
related to comfort and to getting the best quality of sleep. The stereotype of age / relationship
length and separate sleeping usually has to do with stereotypes about "romance fading away" or
things of the kind. However, the most popular reasons in general are far more specific and practical.
It is understandable that couples who have been together longer (say 16-20) years may 
be at the point where they can comfortably communicate that it would be best to have separate beds. 
This data does show some nuance, however, in the relation between age of a person, relationship length, 
and the likelihood that they sleep separately at all because in ages 44-60 the person is shown to be more
likely to sleep separately from their partner than ages over 60. There are more factors that could be considered though.
For example, the lens of the data could zoom in more and look specifically at people above 40 where both people in the
relationship are above the age of 30 and aim to examine more reasons for sleeping separately that could have more emotional 
ties than practical ties. 

# 4 Limitations / Recommendations: 

There are several limitations to this data. The aspect of gender identity is 
neglected in this survey, only male and female options are given and there is no
indication of which gender identity the partner or the person taking the survey is. 
It would be an interesting aspect to consider the patterns among different types of 
couples in the US (in terms of gender and sexual identity and how that varies depending on 
age/generation).






***







