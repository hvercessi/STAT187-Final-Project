---
title: "project_187"
author: "Huaye Yang"
date: "4/14/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      fig.width=12, 
                      fig.height=10)
# Load the packages
pacman::p_load(gapminder, tidyverse, skimr, socviz, grid, stringr,
               usmap, maps, statebins, viridis, leaflet, cowplot, gridExtra)


```



```{r clean_data}
# Read in data
sleeping_alone_data1 <- read.csv("C:/Users/huaye/Desktop/R_sleeping_alone.csv", stringsAsFactors = T)
# Take a look at the relationship status column, 7 categories
summary(sleeping_alone_data1)
# Rename columns to simpler names based on survey questions
sleeping_alone_data <- sleeping_alone_data1 %>%
  
  rename( Relationship_Status = Which.of.the.following.best.describes.your.current.relationship.status., 
         Relationship_Length = How.long.have.you.been.in.your.current.relationship..If.you.are.not.currently.in.a.relationship..please.answer.according.to.your.last.relationship.,
         How_Often_Sep_Beds = When.both.you.and.your.partner.are.at.home..how.often.do.you.sleep.in.separate.beds., 
         Diff_Bed_Where_You_Sleep = When.you.re.not.sleeping.in.the.same.bed.as.your.partner..where.do.you.typically.sleep., 
         Diff_Bed_Where_Partner_Sleep = When.you.re.not.sleeping.in.the.same.bed..where.does.your.partner.typically.sleep., 
         Sep_Beds_Reasons = What.are.the.reasons.that.you.sleep.in.separate.beds..Please.select.all.that.apply., 
         When_First_Time_Sep_Beds = When.was.the.first.time.you.slept.in.separate.beds., 
         Statement_Help_Stay_Together =  To.what.extent.do.you.agree.with.the.following.statement...sleeping.in.separate.beds.helps.us.to.stay.together.., 
         Statement_Better_Sleep =  To.what.extent.do.you.agree.with.the.following.statement...we.sleep.better.when.we.sleep.in.separate.beds..,
         Statement_Improved_Sex_Life = To.what.extent.do.you.agree.with.the.following.statement.éš..our.sex.life.has.improved.as.a.result.of.sleeping.in.separate.beds..éš., 
         Current_Occupation =  Which.of.the.following.best.describes.your.current.occupation.,
         Household_Income = Household.Income,  
         Location_Census_Region = Location..Census.Region.)
  
sleeping_alone_data <- sleeping_alone_data %>% slice(-c(1))
head(sleeping_alone_data)
```

### 2.2 Occupation and Income (Graph 2 and Graph 3)

# Relate occupation,gender and bed status with how often they sleep separately.

### 2.2.1 Graph 2
```{r 2b_graph2}
# change the default theme below:
theme_set(theme_bw())


# take a look at the categories of How_Often_Sep_Beds
summary(sleeping_alone_data$How_Often_Sep_Beds)

# change How_Often_Sep_Beds into an ordered factor
rank<-as.factor(sleeping_alone_data$How_Often_Sep_Beds)

sleeping_alone_data4 <- sleeping_alone_data %>%
  mutate(How_Often_Sep_Beds = factor(rank, ordered = TRUE, 
                                    levels = c("Never",
                                               "Once a year or less",
                                               "Once a month or less",
                                               "A few times per month",
                                               "A few times per week",
                                               "Every night")))



# Relate occupation to how often they sleep separately

sleeping_alone_data4 %>%
  filter(Current_Occupation != "") %>% 

  ggplot(aes(x = How_Often_Sep_Beds,
             fill = Current_Occupation)) +
  geom_bar()+
  
  guides(fill=guide_legend(title="Occupation"))+

  facet_wrap(~Current_Occupation)+ 
  
  theme(axis.text.x = element_text(angle = 90,
                                   hjust = 1,
                                   vjust = 0.25,
                                   size = 7),
        legend.position = "top",
        legend.text = element_text(size = 7),
        legend.key.size = unit(0.25,'cm'),
        legend.title = element_text(size= 8),
        axis.title.x = element_blank(),
        axis.title.y = element_blank())



# summary() to see each category name and ready to draw plots for top 5 
# of the categories. 
summary(sleeping_alone_data$Current_Occupation)



# create a new dataset which contains the top 5(ranked from number
# of participants) occupation
sleeping_alone_data4_1 <- sleeping_alone_data4 %>%
  select(Current_Occupation,How_Often_Sep_Beds) %>%
  filter(Current_Occupation == "Education, Training, and Library Occupations"|
           Current_Occupation == "Other (please specify)"|
           Current_Occupation == "Office and Administrative Support Occupations"|
           Current_Occupation == "Management Occupations"|
           Current_Occupation == "Sales and Related Occupations") 


# create a proportion variable for plotting
sleeping_alone_data4_1 <- sleeping_alone_data4_1 %>%
  
  group_by(Current_Occupation, How_Often_Sep_Beds) %>% 
 
  summarise(freq = n()) %>% 
 
  mutate(Prop = round(freq/sum(freq), digits = 5)) %>% 
 
  select(Current_Occupation, How_Often_Sep_Beds, Prop) %>% 
 
  ungroup()

# make a bar plot and separate for top 5 occupations
ggplot(data = sleeping_alone_data4_1, aes(y = Prop,
                                          x = How_Often_Sep_Beds,
                                          fill = Current_Occupation))+
  
  geom_col(show.legend = F)+
  
  scale_y_continuous(labels = scales::percent)+
  
  facet_wrap(~Current_Occupation)+
  
  
  theme(axis.text.x = element_text(angle = 90),
        axis.title.x = element_blank(),
        axis.title.y = element_blank())
  


## for people who have further response instead of checking boxes
## (choose to plot those who answered "retired" or "Retired)
sleeping_alone_data4 %>%
 filter(X.12 == "retired" | X.12 == "Retired")%>%
 mutate(X.12 ="retired") %>%
 
 ggplot(aes(x = X.12, fill= How_Often_Sep_Beds)) +
 
 geom_bar(color="white",position = "dodge")+
  
 guides(fill=guide_legend(title="Sleep Separately Frequency"))+
 
 theme(axis.text.x = element_text("Retired"),
       axis.title.x = element_blank(),
       axis.title.y = element_blank()) 


```
### 2.2.2 Summarizing Paragraph
The first thing we need to notice from the first overall plot is the proportion
of each occupation that our participants came from. Since they all have the 
same scale on y-axis, it is not hard to find the top 5 occupations(ranked in 
number of participants).Also, this gave us a general sense of the make-up for
our dataset and how representative it is.We would like to look at the top 5 
occupations in detail and give a more specific interpretation. The top 5
occupations, as we see in second plot, are [Education, Training, and Library 
Occupations](138 participants),[Other (please specify)](289 participants),
[Office and Administrative Support Occupations](82 participants),
[Management Occupations](67 participants),[Sales and Related Occupations]
(53 participants). 


People who are in Education, Training, and Library Occupations seems to have the 
most response of "Never" sleeping separately(around 50% ~ 60%). Regardless of the 
occupation,the number of people who sleep separately is bigger than other 
frequencies.This might refer to a bias where participants may over/under
estimate their circumstances while doing self-evaluation.


For people who checked the box of "Other(please specify)", we select retired 
samples to draw a bar graph. Distribution of people who retired have heavy tails
on both side(Never & Every night), but the number of people who never sleeping 
separately is almost twice as large as those who sleeping separately every night.


### 2.2.3 Graph 3
```{r 2b_graph3}

# take a look at the categories of Household_Income
summary(sleeping_alone_data4$Household_Income)

# change Household_Income into an ordered factor(in the dataset where 
# How_Often_Sep_Beds alreay function as an ordered factor)
rank<-as.factor(sleeping_alone_data4$Household_Income)

sleeping_alone_data4_2 <- sleeping_alone_data4 %>%
  mutate(Household_Income = factor(rank, ordered = TRUE, 
                                     levels = c("NA",
                                                "$0 - $24,999",
                                                "$25,000 - $49,999",
                                                "$50,000 - $99,999",
                                                "$100,000 - $149,999",
                                                "$150,000+",
                                                "Response")))
# create a proportion variable for plotting
sleeping_alone_data4_2 <- sleeping_alone_data4_2 %>%
  
  group_by(Household_Income, How_Often_Sep_Beds) %>% 
 
  summarise(freq = n()) %>% 
 
  mutate(Prop = round(freq/sum(freq), digits = 5)) %>% 
 
  select(Household_Income, How_Often_Sep_Beds, Prop) %>% 
 
  ungroup()

# make a bar plot and separate by Household_Income
sleeping_alone_data4_2 %>% 
  filter(Household_Income != "NA") %>%
  
  ggplot(aes(y = Prop,
             x = How_Often_Sep_Beds,
             fill = Household_Income)) +
  geom_col(show.legend = F)+
  
  scale_y_continuous(labels = scales::percent)+
  
  theme(axis.text.x = element_text(angle = 90),
        axis.title.x = element_blank(),
        axis.title.y = element_blank())+
  
  facet_wrap(~Household_Income)




```
### 2.2.4 Summarizing Paragraph:
When we relate household income to how often participants sleep separately with
their partner, we can see that there is not a significant difference between 
groups with different levels of income. The proportion of answers for both tails
takes more than half of the total number of answers. The number of answer tend 
to decrease as the frequency of sleeping separately increases, but not for both 
tails.

